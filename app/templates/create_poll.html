{% extends "base.html" %}

{% block title %}Create a New Poll{% endblock %}

{% block content %}
<div class="dashboard-layout">

    <aside class="sidebar">
        <div class="sidebar-widget">
            <h3 class="widget-title">Posting Tips</h3>
            <ul style="list-style: none; padding: 0; font-size: 0.9rem; color: var(--text-muted);">
                <li style="margin-bottom: 12px;">
                    <strong style="color: var(--text-main);">Keep it short</strong><br>
                    Short titles get more votes.
                </li>
                <li style="margin-bottom: 12px;">
                    <strong style="color: var(--text-main);">Be clear</strong><br>
                    Make sure your options cover all bases.
                </li>
                <li style="margin-bottom: 12px;">
                    <strong style="color: var(--text-main);">Engage</strong><br>
                    Ask questions that spark debate!
                </li>
            </ul>
        </div>
        

    </aside>

    <main class="feed">
        <div class="card">
            <h2 style="margin-bottom: 20px;">Create a New Poll</h2>
            
            <form method="POST" id="poll-form">
                
                <div style="margin-bottom: 20px;">
                    <label for="title" style="display:block; margin-bottom: 8px; font-weight: 600;">Question / Title</label>
                    <input type="text" name="title" id="title" required maxlength="40" 
                           placeholder="e.g., What is the best winter game?" 
                           style="font-size: 1.1rem; padding: 14px;">
                </div>

                <div style="margin-bottom: 25px;">
                    <label for="description" style="display:block; margin-bottom: 8px; font-weight: 600;">Description (Optional)</label>
                    <textarea name="description" id="description" maxlength="70" rows="3" 
                              placeholder="Add a little context..." 
                              style="resize: none;"></textarea>
                    <div style="text-align: right; font-size: 0.8rem; color: var(--text-muted);">Max 70 characters</div>
                </div>
                <div class="form-group" style="margin-top: 20px;">
    <label for="files" style="display: block; font-weight: 600; margin-bottom: 10px;">Upload your files</label>
    
    <div class="upload-container">
        <label for="files" class="upload-dropzone" id="dropzone">
            <i class="fa-solid fa-cloud-arrow-up"></i>
            <span id="file-label">Drag & drop or click to upload</span>
            <small>Images, Videos, Audio, or Text files</small>
            <div id="file-preview-count" class="file-badge" style="display: none;"></div>
        </label>
        <input type="file" id="files" name="files" multiple hidden onchange="handleFileSelect(this)">
    </div>
    
    <div style="display: flex; justify-content: space-between; margin-top: 8px;">
        <small style="color: var(--text-muted);">Max size: 10MB per file</small>
        <small style="color: var(--text-muted); font-weight: 600;">Multiple files allowed</small>
    </div>
</div>
                <div class="form-group">
                <label for="end_date">Poll Ends At (Optional):</label>
                <input type="datetime-local" class="form-control" id="end_date" name="end_date">
            </div>
                <hr style="border: 0; border-top: 1px solid var(--border-subtle); margin: 25px 0;">
                
                <h4 style="margin-bottom: 15px;">Poll Options</h4>
                
                <div id="options-container">
                    <div class="form-group" style="margin-bottom: 12px;">
                        <input type="text" name="options" placeholder="Option 1" required maxlength="25">
                    </div>
                    <div class="form-group" style="margin-bottom: 12px;">
                        <input type="text" name="options" placeholder="Option 2" required maxlength="25">
                    </div>
                </div>
                
                <button type="button" id="add-option-btn" class="btn btn-outline" style="width: 100%; border-style: dashed; margin-top: 10px;">
                    + Add Another Option
                </button>

                <br><br>
                
                <button type="submit" class="btn btn-primary" style="width: 100%; padding: 14px; font-size: 1rem;">
                    âœˆ Publish Poll
                </button>
            </form>
        </div>
    </main>

</div>

<script>
    document.getElementById('add-option-btn').addEventListener('click', function() {
        const container = document.getElementById('options-container');
        const currentCount = container.querySelectorAll('input').length;
        
        // Safety limit (optional, to stop spam)
        if (currentCount >= 10) {
            alert("Maximum 10 options allowed!");
            return;
        }

        const optionCount = currentCount + 1;

        const newOptionDiv = document.createElement('div');
        newOptionDiv.className = 'form-group';
        newOptionDiv.style.marginBottom = '12px'; // Keep spacing consistent
        
        const newOptionInput = document.createElement('input');
        newOptionInput.type = 'text';
        newOptionInput.name = 'options';
        newOptionInput.placeholder = 'Option ' + optionCount;
        newOptionInput.maxLength = 25;
        newOptionInput.required = true; // Make sure they don't submit empty blanks
        
        // Add a nice fade-in animation
        newOptionInput.style.animation = "fadeIn 0.3s ease";
        
        newOptionDiv.appendChild(newOptionInput);
        container.appendChild(newOptionDiv);
    });
</script>
<script>
function handleFileSelect(input) {
    const fileLabel = document.getElementById('file-label');
    const badge = document.getElementById('file-preview-count');
    const count = input.files.length;

    if (count > 0) {
        fileLabel.textContent = "Files selected!";
        fileLabel.style.color = "var(--primary)";
        
        badge.textContent = count + (count === 1 ? " file" : " files") + " ready";
        badge.style.display = "inline-block";
    } else {
        fileLabel.textContent = "Drag & drop or click to upload";
        fileLabel.style.color = "var(--text-main)";
        badge.style.display = "none";
    }
}

// Optional: Add drag & drop visual feedback
const dropzone = document.getElementById('dropzone');
['dragenter', 'dragover'].forEach(eventName => {
    dropzone.addEventListener(eventName, e => {
        dropzone.style.borderColor = "var(--primary)";
        dropzone.style.backgroundColor = "var(--bg-card)";
    }, false);
});

['dragleave', 'drop'].forEach(eventName => {
    dropzone.addEventListener(eventName, e => {
        dropzone.style.borderColor = "var(--border-subtle)";
        dropzone.style.backgroundColor = "var(--bg-body)";
    }, false);
});
</script>
<style>
    /* Small animation for adding new options */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-5px); }
        to { opacity: 1; transform: translateY(0); }

        
    }
</style>
{% endblock %}